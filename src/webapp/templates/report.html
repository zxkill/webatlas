{% extends "base.html" %}
{% from "partials/_status.html" import status_pill %}

{% block content %}
<a class="back" href="/">← Назад</a>

{% if not report %}
<div class="card" style="margin-top:14px;">
    <div class="card-header">
        <div>
            <p class="card-title">Отчёт не найден</p>
            <p class="card-subtitle">Домен отсутствует в базе данных.</p>
        </div>
    </div>
    <div class="card-body">
        <p class="hint">Домен: <span class="mono">{{ domain }}</span></p>
    </div>
</div>
{% else %}
{% set module_blocks = report.module_blocks or report.get('module_blocks') or [] %}

<div class="card" style="margin-top:14px;">
    <div class="card-header">
        <div>
            <p class="card-title">Отчёт по домену</p>
            <p class="card-subtitle"><span class="mono">{{ report.domain or report.get('domain', domain) }}</span></p>
        </div>
        <span class="pill"><span class="dot"></span>Report</span>
    </div>

    <div class="card-body stack">
        <div class="kvs">
            <div class="k">Источник</div>
            <div class="v">{{ report.source or report.get('source','-') }}</div>
            <div class="k">Создан</div>
            <div class="v">{{ report.created_at or report.get('created_at','-') }}</div>
            <div class="k">Обновлён</div>
            <div class="v">{{ report.updated_at or report.get('updated_at','-') }}</div>
        </div>
    </div>
</div>

<div class="grid" style="margin-top:16px; grid-template-columns: 1fr;">
    {% if module_blocks %}
    {% for block in module_blocks %}
        <div class="card">
            {% set tpl = block.template %}
            {% if tpl and (tpl.startswith('/') or tpl.startswith('audit_modules/')) %}
              {% include tpl %}
            {% else %}
              {% include "_generic_block.html" %}
            {% endif %}
        </div>
    {% endfor %}
    {% else %}
    <div class="card">
        <div class="card-body">
            <p class="hint">Данных по модулям пока нет.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}
